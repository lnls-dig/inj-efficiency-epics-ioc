#!/usr/bin/env bash

set -u

if [ -z "$INJ_EFFICIENCY_INSTANCE" ]; then
    echo "INJ_EFFICIENCY_INSTANCE environment variable is not set." >&2
    exit 1
fi

export INJ_EFFICIENCY_CURRENT_PV_AREA_PREFIX=INJ_EFFICIENCY_${INJ_EFFICIENCY_INSTANCE}_PV_AREA_PREFIX
export INJ_EFFICIENCY_CURRENT_PV_DEVICE_PREFIX=INJ_EFFICIENCY_${INJ_EFFICIENCY_INSTANCE}_PV_DEVICE_PREFIX
export INJ_EFFICIENCY_CURRENT_FIRST_ICT_PREFIX=INJ_EFFICIENCY_${INJ_EFFICIENCY_INSTANCE}_FIRST_ICT_PREFIX
export INJ_EFFICIENCY_CURRENT_SECOND_ICT_PREFIX=INJ_EFFICIENCY_${INJ_EFFICIENCY_INSTANCE}_SECOND_ICT_PREFIX
export INJ_EFFICIENCY_CURRENT_DEVICE_TELNET_PORT=INJ_EFFICIENCY_${INJ_EFFICIENCY_INSTANCE}_TELNET_PORT
# Only works with bash
export INJ_EFFICIENCY_PV_AREA_PREFIX=${!INJ_EFFICIENCY_CURRENT_PV_AREA_PREFIX}
export INJ_EFFICIENCY_PV_DEVICE_PREFIX=${!INJ_EFFICIENCY_CURRENT_PV_DEVICE_PREFIX}
export INJ_EFFICIENCY_FIRST_ICT_PREFIX=${!INJ_EFFICIENCY_CURRENT_FIRST_ICT_PREFIX}
export INJ_EFFICIENCY_SECOND_ICT_PREFIX=${!INJ_EFFICIENCY_CURRENT_SECOND_ICT_PREFIX}
export INJ_EFFICIENCY_DEVICE_TELNET_PORT=${!INJ_EFFICIENCY_CURRENT_DEVICE_TELNET_PORT}

./runProcServ.sh \
    -t "${INJ_EFFICIENCY_DEVICE_TELNET_PORT}" \
    -P "${INJ_EFFICIENCY_PV_AREA_PREFIX}" \
    -R "${INJ_EFFICIENCY_PV_DEVICE_PREFIX}" \
    -f "${INJ_EFFICIENCY_FIRST_ICT_PREFIX}" \
    -s "${INJ_EFFICIENCY_SECOND_ICT_PREFIX}"
